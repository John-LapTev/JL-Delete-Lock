@echo off
chcp 65001 >nul
title Запуск JL Delete Lock

:: Переходим в корневую директорию проекта
cd /d "%~dp0"

echo ===============================================================
echo             Запуск JL Delete Lock из исходного кода
echo ===============================================================
echo.

:: Проверяем наличие виртуального окружения
if not exist "venv" (
    echo [ОШИБКА] Виртуальное окружение не найдено.
    echo Пожалуйста, сначала запустите scripts\setup.bat для настройки программы.
    pause
    exit /b 1
)

:: Проверяем наличие файлов исходного кода
if not exist "src\main.py" (
    echo [ОШИБКА] Файл src\main.py не найден.
    echo Проверьте структуру проекта и наличие всех необходимых файлов.
    pause
    exit /b 1
)

echo [1/2] Активация виртуального окружения...
call venv\Scripts\activate.bat

echo [2/2] Запуск программы...
echo.
echo Программа запущена! Для выхода закройте окно программы.
echo.
echo Лог работы программы: 
echo -----------------------------------------------------------

:: Установка PYTHONPATH для включения текущей директории
set PYTHONPATH=%CD%

:: Запускаем программу с выводом ошибок в консоль
python -u src\main.py %* 2>&1

:: Проверяем код возврата
if %errorlevel% neq 0 (
    echo.
    echo -----------------------------------------------------------
    echo [ОШИБКА] Программа завершилась с ошибкой (код %errorlevel%).
    echo.
    echo Нажмите любую клавишу, чтобы закрыть окно...
    pause >nul
) else (
    echo.
    echo -----------------------------------------------------------
    echo Программа завершила работу успешно.
    timeout /t 3 >nul
)

:: Деактивируем виртуальное окружение при закрытии программы
call venv\Scripts\deactivate.bat